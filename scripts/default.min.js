/*! routely - v1.0.0 - 2014-05-05 */
var routely={};
routely.app=function(){"use strict";var a=(routely.ajax,routely.api,new routely.map),b=null,c=null,d=null,e=function(a){return void 0===typeof a},f=function(){a.init({containerId:b,serviceContainerId:c,scheduleContainerId:d,zoom:17,latitude:51.50722,longitude:-.1275})};return{init:function(a){e(a)||e(a.mapContainerId)||e(a.serviceContainerId)||e(a.scheduleContainerId)||(c=$(a.serviceContainerId),b=$(a.mapContainerId),d=$(a.scheduleContainerId),e(c)||e(b)||e(d)||f())}}};
routely.ajax=function(){"use strict";var a=function(a,b,c,d,e){var f={Success:!1,Status:"",Model:b,Url:c,Params:d,Data:{},JqXHR:{}};return null!==d&&(d=JSON.stringify(d)),$.ajax({type:a,url:c,dataType:"jsonp",success:function(a,b,c){f.Success=!0,f.Data=a,f.Status=b,f.JqXHR=c},error:function(a,b,c){f.Status=b,f.JqXHR=a,f.Exception=c},complete:function(){e&&e(f)}}),this};return{get:function(b,c,d,e){return a("GET",b,c,d,e)},post:function(b,c,d,e){return a("POST",b,c,d,e)},put:function(b,c,d,e){return a("PUT",b,c,d,e)},"delete":function(b,c,d,e){return a("DELETE",b,c,d,e)}}}();
routely.api=function(){"using strict";var a="http://digitaslbi-id-test.herokuapp.com";return{getStops:function(b){var c=b.split(","),d=a+"/bus-stops";return d+="?northEast=",d+=c[0]+","+c[1],d+="&southWest=",d+=c[2]+","+c[3]},getStop:function(b){return a+"/bus-stops/"+b}}}();
routely.map=function(){"use strict";var a=routely.stop,b=null,c=null,d=null,e=null,f=null,g=function(a,c,d){b={zoom:a,center:new google.maps.LatLng(c,d)}},h=function(){c=new google.maps.Map(d,b),j()},i=function(){var b=c.getBounds().toUrlValue(),g={map:c,mapContainer:d,serviceContainer:e,scheduleContainer:f};a.getStops(g,b)},j=function(){google.maps.event.addListener(c,"bounds_changed",function(a){i(a)})};return{init:function(a){a.containerId&&(d=$(a.containerId)[0],e=$(a.serviceContainerId),f=$(a.scheduleContainerId),g(a.zoom,a.latitude,a.longitude),h())}}};
routely.schedule=function(){"use strict";var a=routely.ajax,b=routely.api,c="<li><span class='r-service'>{{routeId}}</span><span class='r-destination'>{{destination}}</span><span class='r-scheduled'>{{scheduledTime}}</span><span class='r-remaining'>{{estimatedWait}}</span></li>",d=Handlebars.compile(c),e=function(c,d){var e=$(c),g=e.attr("rel"),h=b.getStop(g);d.html("<p><img src='images/ajax-loader.gif' alt='loading' /></p>"),a.get(d,h,null,f)},f=function(a){if(a.Success){var b=a.Data,c=a.Model;g(c,b)}},g=function(a,b){var c=b.arrivals,e="<p>No schedule buses for this stop at this time.</p>";if(c.length>0){e="<li class='r-heading'><span class='r-service'>Service</span><span class='r-destination'>Destination</span><span class='r-scheduled'>Scheduled</span><span class='r-remaining'>Remaining</span></li>";for(var f=0;f<c.length;f++){var g=c[f];e+=d(g)}}a.html(e)};return{get:e}}();
routely.stop=function(){"use strict";var a=routely.ajax,b=routely.api,c=routely.schedule,d="<li rel='{{id}}' class='js-stop r-stop' title='Click to see schedule from {{name}} to {{towards}}'>{{name}} <span>-</span> {{towards}}</li>",e=Handlebars.compile(d),f=null,g=function(c,d){var e=b.getStops(d),f=c.serviceContainer,g=c.scheduleContainer;f.html("<p><img src='images/ajax-loader.gif' alt='loading' /></p>"),g.html(""),a.get(c,e,null,h)},h=function(a){if(a.Success){var b=a.Data,c=b.markers,d=a.Model,e=d.map,g=d.serviceContainer,h=d.scheduleContainer;if(c.length>0){f="";for(var k=0;k<c.length;k++){{var l=c[k],m=new google.maps.LatLng(l.lat,l.lng);new google.maps.Marker({position:m,map:e})}f+=i(l)}j(g,h,f)}else g.html("<p>No bus stops in this area.</p>")}},i=function(a){return e(a)},j=function(a,b,c){a.html(c);a.find(".js-stop");k(a,b)},k=function(a,b){var d=a.find(".js-stop");d.on("click",function(){c.get(this,b)})};return{getStops:g}}();